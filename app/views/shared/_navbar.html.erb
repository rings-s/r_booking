<nav class="bg-white shadow-lg sticky top-0 z-50" data-controller="navbar">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16">
      <!-- Logo and Brand -->
      <div class="flex items-center">
        <%= link_to root_path, class: "flex items-center space-x-2 group" do %>
          <!-- Logo Icon -->
          <div class="bg-gray-900 p-2 rounded-lg transform group-hover:scale-105 transition duration-200">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          </div>
          <span class="text-xl font-bold text-gray-900">
            <%= t('app_name') %>
          </span>
        <% end %>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex md:items-center md:space-x-6">
        <%= link_to t('nav.home'), root_path, class: "text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out hover:bg-gray-100" %>
        <%= link_to t('nav.businesses'), businesses_path, class: "text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out hover:bg-gray-100" %>
        <%= link_to t('nav.categories'), categories_path, class: "text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out hover:bg-gray-100" %>

        <% if user_signed_in? %>
          <%= link_to t('nav.dashboard'), dashboard_path, class: "text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out hover:bg-gray-100" %>
          <%= link_to t('nav.bookings'), bookings_path, class: "text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out hover:bg-gray-100" %>
        <% end %>

        <!-- Locale Switcher -->
        <div class="relative" data-controller="dropdown">
          <button type="button"
                  data-action="click->dropdown#toggle"
                  class="flex items-center space-x-1 text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out hover:bg-gray-100">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
            </svg>
            <span><%= I18n.locale.to_s.upcase %></span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <div data-dropdown-target="menu"
               class="hidden absolute right-0 mt-2 w-40 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50">
            <div class="py-1">
              <%= link_to set_locale_path(locale: :en), 
                          class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition #{'bg-gray-50 font-semibold' if I18n.locale == :en}" do %>
                <span class="fi fi-us mr-2"></span>
                English
              <% end %>
              <%= link_to set_locale_path(locale: :ar), 
                          class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition #{'bg-gray-50 font-semibold' if I18n.locale == :ar}" do %>
                <span class="fi fi-sa mr-2"></span>
                العربية
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Desktop Auth Buttons / User Menu -->
      <div class="hidden md:flex md:items-center md:space-x-4">
        <% if user_signed_in? %>
          <!-- User Dropdown -->
          <div class="relative">
            <button type="button"
                    data-navbar-target="userMenuButton"
                    data-action="click->navbar#toggleUserMenu"
                    class="flex items-center space-x-3 text-gray-700 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 rounded-full p-1 transition duration-150 ease-in-out">
              <!-- User Avatar -->
              <% if current_user.avatar_url.present? %>
                <%= image_tag current_user.avatar_url, class: "h-8 w-8 rounded-full object-cover border-2 border-gray-200" %>
              <% else %>
                <div class="h-8 w-8 rounded-full bg-gray-900 flex items-center justify-center text-white font-semibold text-sm border-2 border-gray-200">
                  <%= current_user.name&.first&.upcase || current_user.email.first.upcase %>
                </div>
              <% end %>
              <span class="text-sm font-medium"><%= current_user.name || current_user.email.split('@').first %></span>
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </button>

            <!-- Dropdown Menu -->
            <div data-navbar-target="userMenu"
                 class="hidden opacity-0 scale-95 absolute right-0 mt-2 w-56 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5 transform transition-all duration-200 ease-out origin-top-right">
              <div class="py-1">
                <!-- User Info -->
                <div class="px-4 py-3 border-b border-gray-100">
                  <p class="text-sm font-medium text-gray-900"><%= current_user.name || 'User' %></p>
                  <p class="text-xs text-gray-500 truncate"><%= current_user.email %></p>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mt-1">
                    <%= current_user.role.capitalize %>
                  </span>
                </div>

                <!-- Menu Items -->
                <%= link_to pages_profile_path, class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 transition duration-150" do %>
                  <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  <%= t('nav.profile') %>
                <% end %>

                <%= link_to bookings_path, class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 transition duration-150" do %>
                  <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                  <%= t('nav.bookings') %>
                <% end %>

                <% if current_user.owner? || current_user.admin? %>
                  <%= link_to businesses_path, class: "flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 transition duration-150" do %>
                    <svg class="w-4 h-4 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    <%= t('nav.businesses') %>
                  <% end %>
                <% end %>

                <div class="border-t border-gray-100"></div>

                <%= button_to destroy_user_session_path, method: :delete, data: { turbo: true }, form: { data: { turbo: "true" } }, class: "flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition duration-150" do %>
                  <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                  </svg>
                  <%= t('nav.sign_out') %>
                <% end %>
              </div>
            </div>
          </div>
        <% else %>
          <!-- Sign In / Sign Up Buttons -->
          <%= link_to t('nav.sign_in'), new_user_session_path, class: "text-gray-700 hover:text-gray-900 px-4 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out hover:bg-gray-100" %>
          <%= link_to t('nav.sign_up'), new_user_registration_path, class: "bg-gray-900 hover:bg-gray-800 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition duration-150 ease-in-out" %>
        <% end %>
      </div>

      <!-- Mobile Menu Button -->
      <div class="flex items-center md:hidden">
        <button type="button"
                data-navbar-target="mobileMenuButton"
                data-action="click->navbar#toggleMobileMenu"
                class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-blue-600 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 transition duration-150">
          <span class="sr-only">Open main menu</span>
          <!-- Hamburger Icon -->
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div data-navbar-target="mobileMenu" class="hidden md:hidden border-t border-gray-200 bg-white shadow-lg">
    <div class="px-2 pt-2 pb-3 space-y-1">
      <%= link_to t('nav.home'), root_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150" %>
      <%= link_to t('nav.businesses'), businesses_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150" %>
      <%= link_to t('nav.categories'), categories_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150" %>

      <% if user_signed_in? %>
        <%= link_to t('nav.dashboard'), dashboard_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150" %>
        <%= link_to t('nav.bookings'), bookings_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150" %>
      <% end %>

      <!-- Mobile Locale Switcher -->
      <div class="border-t border-gray-200 pt-2 mt-2">
        <p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Language</p>
        <%= link_to set_locale_path(locale: :en), data: { action: "click->navbar#closeMobileMenu" }, class: "flex items-center px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150 #{'bg-gray-100 font-semibold' if I18n.locale == :en}" do %>
          <span class="fi fi-us mr-2"></span>
          English
        <% end %>
        <%= link_to set_locale_path(locale: :ar), data: { action: "click->navbar#closeMobileMenu" }, class: "flex items-center px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150 #{'bg-gray-100 font-semibold' if I18n.locale == :ar}" do %>
          <span class="fi fi-sa mr-2"></span>
          العربية
        <% end %>
      </div>
    </div>

    <!-- Mobile User Section -->
    <% if user_signed_in? %>
      <div class="pt-4 pb-3 border-t border-gray-200">
        <div class="flex items-center px-5">
          <% if current_user.avatar_url.present? %>
            <%= image_tag current_user.avatar_url, class: "h-10 w-10 rounded-full object-cover" %>
          <% else %>
            <div class="h-10 w-10 rounded-full bg-gray-900 flex items-center justify-center text-white font-semibold">
              <%= current_user.name&.first&.upcase || current_user.email.first.upcase %>
            </div>
          <% end %>
          <div class="ml-3">
            <div class="text-base font-medium text-gray-800"><%= current_user.name || 'User' %></div>
            <div class="text-sm font-medium text-gray-500"><%= current_user.email %></div>
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mt-1">
              <%= current_user.role.capitalize %>
            </span>
          </div>
        </div>
        <div class="mt-3 px-2 space-y-1">
          <%= link_to t('nav.profile'), pages_profile_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150" %>

          <% if current_user.owner? || current_user.admin? %>
            <%= link_to t('nav.businesses'), businesses_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150" %>
          <% end %>

          <%= button_to t('nav.sign_out'), destroy_user_session_path, method: :delete, data: { turbo: true, action: "click->navbar#closeMobileMenu" }, form: { data: { turbo: "true" } }, class: "block w-full text-left px-3 py-2 rounded-md text-base font-medium text-red-600 hover:bg-red-50 transition duration-150" %>
        </div>
      </div>
    <% else %>
      <div class="pt-4 pb-3 border-t border-gray-200 px-2 space-y-2">
        <%= link_to t('nav.sign_in'), new_user_session_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block w-full text-center px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition duration-150" %>
        <%= link_to t('nav.sign_up'), new_user_registration_path, data: { action: "click->navbar#closeMobileMenu" }, class: "block w-full text-center px-3 py-2 rounded-md text-base font-medium bg-gray-900 text-white hover:bg-gray-800 shadow-md transition duration-150" %>
      </div>
    <% end %>
  </div>
</nav>
